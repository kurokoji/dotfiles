[[plugins]]
repo = 'Shougo/ddu.vim'
depends = ['denops.vim']
on_source = 'denops.vim'
# hook_add {{{
hook_add = '''
"nnoremap <silent> <C-u><C-p> :call ddu#start()<CR>
nnoremap <silent> <C-u><C-p> :call ddu#start(#{ name: 'fd-file_rec' })<CR>
"nnoremap <silent> <C-u><C-p> :call ddu#start(#{ name: 'file_rec' })<CR>
nnoremap <silent> <C-u><C-g> :call ddu#start(#{ name: 'grep' })<CR>
nnoremap <silent> <C-u><C-]> :call ddu#start(#{ name: 'grep', sources: [#{ name: 'rg', params: #{ input: expand('<cword>')} }] })<CR>
" nnoremap <silent> <C-u><C-]> :call ddu#start(#{ name: 'cursor-grep' })<CR>
nnoremap <silent> <C-u><C-m> :call ddu#start(#{ name: 'filer' })<CR>

'''
# }}}
# hook_source {{{
hook_source = '''
call ddu#custom#patch_global(#{
    \   ui: 'ff',
    \   sourceOptions: #{
    \     _: #{
    \       matchers: ['matcher_substring'],
    \     },
    \     file_rec: #{
    \       matchers: ['matcher_substring', 'matcher_hidden'],
    \       columns: ['icon_filename']
    \     },
    \     file_external: #{
    \       matchers: ['matcher_fzf'],
    \       sorters: ['sorter_fzf'],
    \       columns: ['icon_filename']
    \     },
    \     file: #{
    \       matchers: ['matcher_substring'],
    \       columns: ['icon_filename'],
    \     }
    \   },
    \   sourceParams: #{
    \     file_rec: #{
    \       ignoredDirectories: ['.git', 'node_modules', '.cache', 'go']
    \     },
    \   },
    \   columnParams: #{
    \     icon_filename: #{
    \       padding: 0,
    \       span: 2,
    \       pathDisplayOption: "relative",
    \       defaultIcon: #{ icon: '' },
    \       colors: #{
    \         default: 'Normal',
    \         aqua: '#74b2c9',
    \         beige: '#a36f3e',
    \         blue: '#4e75aa',
    \         brown: '#ba793e',
    \         darkBlue: '#485e7d',
    \         darkOrange: '#d76558',
    \         green: '#629f81',
    \         lightGreen: '#618774',
    \         lightPurple: '#8e6f98',
    \         orange: '#e8857a',
    \         pink: '#de8db7',
    \         purple: '#9f75ac',
    \         red: '#c76882',
    \         salmon: '#b95d76',
    \         yellow: '#ca884a',
    \       }
    \     }
    \   },
    \   kindOptions: #{
    \     file: #{
    \       defaultAction: 'open',
    \     },
    \   },
    \   uiParams: #{
    \     ff: #{
    \       startFilter: v:true,
    \       split: 'floating',
    \       filterSplitDirection: 'floating',
    \       filterFloatingPosition: 'bottom',
    \       floatingBorder: ['┏', '━', '┓', '┃', '┛', '━', '┗', '┃'],
    \       previewFloating: v:true,
    \       previewSplit: 'vertical',
    \       prompt: '❯ ',
    \       displaySourceName: 'none',
    \       previewFloatingBorder: ['┏', '━', '┓', '┃', '┛', '━', '┗', '┃'],
    \       highlights: #{
    \         floating: '',
    \       }
    \     },
    \   },
    \ })

call ddu#custom#patch_local('filer', #{
    \   ui: 'filer',
    \   sources: [
    \     #{ name: 'file' }
    \   ],
    \   uiParams: #{
    \     filer: #{
    \       split: 'floating',
    \       previewFloating: v:true,
    \       floatingBorder: ['┏', '━', '┓', '┃', '┛', '━', '┗', '┃'],
    \       previewFloatingBorder: ['┏', '━', '┓', '┃', '┛', '━', '┗', '┃'],
    \       previewSplit: 'vertical',
    \       highlights: #{
    \         floating: '',
    \       }
    \     },
    \   },
    \   actionOptions: #{
    \     narrow: #{
    \       quit: v:false,
    \     },
    \   },
    \   columnParams: #{
    \     icon_filename: #{
    \       pathDisplayOption: "basename",
    \     }
    \   },
    \ })

call ddu#custom#patch_local('fd-file_rec', #{
    \   sources: [
    \     #{ name: 'file_external'}
    \   ],
    \   sourceParams: #{
    \     file_external: #{
    \       cmd: ['fd', '.', '-H', '-t', 'f'],
    \       updateItems: 1000,
    \     },
    \   },
    \ })

call ddu#custom#patch_local('grep', #{
    \   uiParams: #{
    \     ff: #{
    \       ignoreEmpty: v:false,
    \       autoResize: v:false,
    \     },
    \   },
    \   sources: [#{ name: 'rg', options: #{ volatile: v:true } } ],
    \   sourceParams: #{
    \     rg: #{
    \       args: ['--threads', '4', '--column', '--no-heading', '--color', 'never', '--json', '--hidden'],
    \     },
    \   },
    \ })

call ddu#custom#patch_local('file_rec', #{
    \   sources: [#{ name: 'file_rec' }],
    \ })


autocmd FileType ddu-ff call s:ddu_my_settings()
function! s:ddu_my_settings() abort
  nnoremap <buffer><silent> <CR>
        \ <Cmd>call ddu#ui#ff#do_action('itemAction', #{name: 'open'})<CR>
  nnoremap <buffer><silent> <Space>
        \ <Cmd>call ddu#ui#ff#do_action('toggleSelectItem')<CR>
  nnoremap <buffer><silent> i
        \ <Cmd>call ddu#ui#ff#do_action('openFilterWindow')<CR>
  nnoremap <buffer><silent> <ESC>
        \ <Cmd>call ddu#ui#ff#do_action('quit')<CR>
  nnoremap <buffer><silent> v
        \ <Cmd>call ddu#ui#ff#do_action('preview')<CR>
endfunction

autocmd FileType ddu-ff-filter call s:ddu_filter_my_settings()
function! s:ddu_filter_my_settings() abort
  inoremap <buffer><silent> <CR>
  \ <Esc><Cmd>close<CR>
  nnoremap <buffer><silent> <CR>
  \ <Cmd>close<CR>
  nnoremap <buffer><silent> <ESC>
  \ <Cmd>close<CR>
endfunction

autocmd FileType ddu-filer call s:ddu_filer_my_settings()
function! s:ddu_filer_my_settings() abort
  nnoremap <buffer><expr> <CR>
        \ ddu#ui#get_item()->get('isTree', v:false) ?
        \ "<Cmd>call ddu#ui#filer#do_action('itemAction', #{name: 'narrow'})<CR>" :
        \ "<Cmd>call ddu#ui#filer#do_action('itemAction', #{name: 'open'})<CR>"
  nnoremap <buffer><silent> <ESC> <Cmd>quit<CR>
  nnoremap <buffer><silent> v
        \ <Cmd>call ddu#ui#filer#do_action('preview')<CR>
  nnoremap <buffer><silent> <BS>
        \ <Cmd>call ddu#ui#filer#do_action('itemAction', #{name: 'narrow', params: #{path: '..'}})<CR>
  nnoremap <buffer><silent> nf
        \ <Cmd>call ddu#ui#filer#do_action('itemAction', #{name: 'newFile'})<CR>
  nnoremap <buffer><silent> nd
        \ <Cmd>call ddu#ui#filer#do_action('itemAction', #{name: 'newDirectory'})<CR>
  nnoremap <buffer><silent> rn
        \ <Cmd>call ddu#ui#filer#do_action('itemAction', #{name: 'rename'})<CR>
  nnoremap <buffer><silent> dd
        \ <Cmd>call ddu#ui#filer#do_action('itemAction', #{name: 'trash'})<CR>
  nnoremap <buffer><silent> u
        \ <Cmd>call ddu#ui#filer#do_action('itemAction', #{name: 'undo'})<CR>
  nnoremap <buffer><silent> y
        \ <Cmd>call ddu#ui#filer#do_action('itemAction', #{name: 'copy'})<CR>
  nnoremap <buffer><silent> p
        \ <Cmd>call ddu#ui#filer#do_action('itemAction', #{name: 'paste'})<CR>
endfunction
'''
# }}}

[[plugins]]
repo = 'Shougo/ddu-commands.vim'
on_source = 'ddu.vim'
on_cmd = 'Ddu'

# source {{{

[[plugins]]
repo = 'Shougo/ddu-source-file'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-source-file_rec'
on_source = 'ddu.vim'


[[plugins]]
repo = 'shun/ddu-source-rg'
on_source = 'ddu.vim'

[[plugins]]
repo = 'matsui54/ddu-source-file_external'
on_source = 'ddu.vim'

# }}}

# ui {{{

[[plugins]]
repo = 'Shougo/ddu-ui-ff'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-ui-filer'
on_source = 'ddu.vim'

# }}}

# filter {{{

[[plugins]]
repo = 'Shougo/ddu-filter-matcher_hidden'
on_source = 'ddu.vim'

[[plugins]]
repo = 'yuki-yano/ddu-filter-fzf'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-filter-converter_display_word'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-filter-matcher_substring'
on_source = 'ddu.vim'

# }}}

# kind {{{

[[plugins]]
repo = 'Shougo/ddu-kind-file'
on_source = 'ddu.vim'

# }}}

# column {{{

[[plugins]]
repo = 'ryota2357/ddu-column-icon_filename'
on_source = 'ddu.vim'

[[plugins]]
repo = 'Shougo/ddu-column-filename'
on_source = 'ddu.vim'

# }}}
